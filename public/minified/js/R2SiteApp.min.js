"use strict";var AuthModule=angular.module("AuthModule",["ngResource"]);AuthModule.config(function($httpProvider){$httpProvider.interceptors.push("AuthInterceptor")}),AuthModule.constant("AUTH_EVENTS",{notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),AuthModule.factory("LoginFactory",["$resource",function($resource){return $resource("/api/user/users/auth/:id",{},{checkIdentity:{method:"GET",isArray:!1},login:{method:"POST"},logout:{method:"DELETE",params:{id:"@id"}}})}]),AuthModule.service("AuthService",["LoginFactory","$q","$http","AUTH_EVENTS",function(LoginFactory,$q,$http,AUTH_EVENTS){function loadUserCredentials(){var token=window.localStorage.getItem(LOCAL_TOKEN_KEY);token?(console.log("TOKEN",token),useCredentials(token)):LoginFactory.checkIdentity(function(data){console.log("CHECK IDENTITY",data),data.data.success&&(token=setToken(data.data.user),storeUserCredentials(token))})}function setToken(user){var token="";return token+=user.id+"|",token+=user.user+"|",token+=user.role.name+"|",token+=user.person.name}function unsetToken(){authToken=void 0,userId="",user="",userRole="",userName=""}function storeUserCredentials(token){window.localStorage.setItem(LOCAL_TOKEN_KEY,token),useCredentials(token)}function useCredentials(token){var secToken=token.split("|");userId=secToken[0],user=secToken[1],userRole=secToken[2],userName=secToken[3],isAuthenticated=!0,authToken=token,console.log("AUTH TOKEN",authToken),$http.defaults.headers.common["X-Auth-Token"]=token}function destroyUserCredentials(){unsetToken(),isAuthenticated=!1,$http.defaults.headers.common["X-Auth-Token"]=void 0,window.localStorage.removeItem(LOCAL_TOKEN_KEY)}var authToken,LOCAL_TOKEN_KEY="token_user",userId="",user="",userRole="",userName="",isAuthenticated=!1,run=function(){loadUserCredentials()},login=function(user,password){var defObj=$q.defer(),login=LoginFactory.login({user:user,password:password});return login.$promise.then(function(data){var user=data.data.user,token=setToken(user);storeUserCredentials(token),defObj.resolve({result:"Login success."})},function(error){defObj.reject({result:AUTH_EVENTS.notAuthenticated,error:error})}),defObj.promise},logout=function(){LoginFactory.logout({id:userId}),destroyUserCredentials()},isAuthorized=function(authorizedRoles){return console.log("USER ROLE",userRole),console.log("AUTHORIZED ROLES",authorizedRoles),angular.isArray(authorizedRoles)||(authorizedRoles=[authorizedRoles]),isAuthenticated&&-1!==authorizedRoles.indexOf(userRole)};return loadUserCredentials(),{run:run,login:login,logout:logout,isAuthorized:isAuthorized,isAuthenticated:function(){return isAuthenticated},getUserId:function(){return userId},getUser:function(){return user},getUserName:function(){return userName},getUserRole:function(){return userRole},getAuthToken:function(){return authToken}}}]),AuthModule.factory("AuthInterceptor",function($rootScope,$q,AUTH_EVENTS){return{responseError:function(response){return console.log("response",response),401==response.status&&$rootScope.$broadcast("notLogged",!0),$rootScope.$broadcast({401:AUTH_EVENTS.notAuthenticated,403:AUTH_EVENTS.notAuthorized}[response.status],response),$q.reject(response)}}}),AuthModule.run(function($templateCache){$templateCache.removeAll()});var TrackerModule=angular.module("TrackerModule",["ngResource"]);TrackerModule.factory("TrackerFactory",["$resource",function($resource){return $resource("/api/tracker/usertracker/:id",{},{mostrar:{method:"GET",isArray:!1},registrar:{method:"POST"},atualizar:{method:"PUT",params:{id:"@id"}},deletar:{method:"DELETE",params:{id:"@id"}}})}]),TrackerModule.service("TrackerService",["TrackerFactory","$q","$http",function(TrackerFactory,$q,$http){function loadTrackerCredentials(){var token=window.localStorage.getItem(LOCAL_TOKEN_KEY),userInit={};if(token)useCredentials(token),!isAuthenticated&&authModule.isAuthenticated()||userId==authModule.getUserId();else{var date=new Date;userInit.userId=date.valueOf()+"r"+Math.floor(1e3*Math.random()+1),userInit.userResolution=$(window).innerWidth()+"x"+$(window).innerHeight(),userInit.isRegistered=!1,registrar(userInit).then(function(promise){})}}function useCredentials(token){}function registrar(userInit){var defObj=$q.defer(),trackerReg=TrackerFactory.registrar(userInit);return trackerReg.$promise.then(function(data){defObj.resolve({result:"Success.",data:data})},function(error){defObj.resolve({result:"Failed.",error:error})}),defObj.promise}var trackToken,LOCAL_TOKEN_KEY="token_tracker",userId="",isAuthenticated=!1,atualizar=function(authorizedRoles){},isTracking=function(){return void 0!==trackToken};return loadTrackerCredentials(),{atualizar:atualizar,isTracking:isTracking}}]),TrackerModule.run(["TrackerService",function(TrackerService){}]);var underscore=angular.module("underscore",[]);underscore.factory("_",[function(){return window._}]);var string=angular.module("string",[]);string.factory("S",[function(){return window.S}]);var PagSeguroDirectPayment=angular.module("PagSeguroDirectPayment",[]);string.factory("PagSeguroDirectPayment",[function(){return window._PagSeguroDirectPayment}]);var StringFilters=angular.module("StringFilters",["string"]);StringFilters.filter("capitalize",function(S){return function(input){return S(input).capitalize().s}}),StringFilters.filter("replaceSpecialChars",function(){return function(input){for(var str_acento="áàãâäéèêëíìîïóòõôöúùûüçÁÀÃÂÄÉÈÊËÍÌÎÏÓÒÕÖÔÚÙÛÜÇ",str_sem_acento="aaaaaeeeeiiiiooooouuuucAAAAAEEEEIIIIOOOOOUUUUC",str="",i=0;i<input.length;i++)str+=-1!=str_acento.indexOf(input.charAt(i))?str_sem_acento.substr(str_acento.search(input.substr(i,1)),1):input.substr(i,1);return str}}),StringFilters.filter("snakeToCamel",function(){return function(input){return s.replace(/(\_\w)/g,function(m){return m[1].toUpperCase()})}});var PluginsDirectives=angular.module("PluginsDirectives",[]);PluginsDirectives.directive("foundationInit",[function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){console.log("FOUNDATION INIT"),$(document).foundation()}}}]),PluginsDirectives.directive("stickyContainer",[function(){return{restrict:"A",replace:!1,link:function(scope,element,attrs){$(element).sticky({topSpacing:0})}}}]),PluginsDirectives.directive("polyfillerInit",[function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){webshim.setOptions("basePath","js/plugins/shims/"),webshims.setOptions("waitReady",!1),webshims.setOptions("forms-ext",{types:"date"}),webshims.polyfill("forms forms-ext")}}}]),PluginsDirectives.directive("polyfillerUpdate",[function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){$(element).updatePolyfill()}}}]),PluginsDirectives.directive("r2ShowHoverMenu",[function(){return{restrict:"C",replace:!1,scope:!1,link:function(scope,element,attrs){$(element).hover(function(event){$(".r2-hover-menu").slideDown("show",function(){$(this).clearQueue()})},function(event){$(".r2-hover-menu").slideUp("show",function(){$(this).clearQueue()})})}}}]),PluginsDirectives.directive("r2ImageFill",[function(){return{restrict:"C",replace:!1,scope:!1,link:function(scope,element,attrs){$(element).imagefill()}}}]),PluginsDirectives.directive("r2ElevateZoom",[function(){return{restrict:"C",replace:!1,scope:!1,link:function(scope,element,attrs){attrs.$observe("zoomImage",function(val){$(element).elevateZoom({zoomType:"inner",cursor:"crosshair"})})}}}]),PluginsDirectives.directive("r2FancyGallery",[function(){return{restrict:"C",replace:!1,scope:!1,link:function(scope,element,attrs){console.log("FANCY GALLERY"),attrs.$observe("zoomImage",function(val){$(element).elevateZoom({gallery:"r2_product_gallery",cursor:"pointer",galleryActiveClass:"active",imageCrossfade:!0,loadingIcon:"http://www.elevateweb.co.uk/spinner.gif"})})}}}]),PluginsDirectives.directive("r2Easyzoom",[function(){return{restrict:"C",replace:!1,scope:!1,link:function(scope,element,attrs){console.log("FANCY GALLERY"),attrs.$observe("zoom",function(val){var $easyzoom=$(element).easyZoom();$easyzoom.data("easyZoom")})}}}]),PluginsDirectives.directive("barouselSlider",[function(){return{restrict:"C",replace:!1,scope:{load:"="},link:function(scope,element,attrs){scope.$watch("load",function(newVal){newVal&&$(element).barousel({navType:2})})}}}]);var DocumentsDirectives=angular.module("DocumentsDirectives",["BaseServices"]);DocumentsDirectives.run(function($templateCache){$templateCache.removeAll()}),DocumentsDirectives.directive("r2baseAddDocuments",["BaseEnumsFactory",function(BaseEnumsFactory){return{restrict:"A",templateUrl:"partials/shared/directives/documents/r2base-add-documents.html",replace:!0,scope:{documentsModel:"=",form:"=",hasEntity:"="},link:function(scope,element,attrs){var documentInterface=attrs.documentInterface;scope.options={documentTypes:[]},scope.documentTypesLoad=!1,BaseEnumsFactory.show(function(result){console.log("BaseEnumsFactory",result),"physical"==documentInterface?_.each(result.data.physicalDocumentType,function(documentType){scope.options.documentTypes.push({name:documentType})}):"legal"==documentInterface?_.each(result.data.legalDocumentType,function(documentType){scope.options.documentTypes.push({name:documentType})}):(_.each(result.data.physicalDocumentType,function(documentType){scope.options.documentTypes.push({name:documentType})}),_.each(result.data.legalDocumentType,function(documentType){scope.options.documentTypes.push({name:documentType})})),scope.documentTypesLoad=!0})}}}]),DocumentsDirectives.directive("r2baseBtnAddDocument",["$compile",function($compile){return function(scope,element,attrs){element.bind("click",function(){"undefined"!=typeof scope.selectedDocumentType&&angular.element(document.getElementById("section-to-documents")).prepend($compile("<div data-r2base-document-collection data-document-type='"+scope.selectedDocumentType.toUpperCase()+"'></div>")(scope))})}}]),DocumentsDirectives.directive("r2basePopulateDocuments",["$compile","_",function($compile,_){return function(scope,element,attrs){scope.$watch("hasEntity",function(newVal){newVal&&scope.documentsModel.length>0&&_.each(scope.documentsModel,function(doc){angular.element(document.getElementById("section-to-documents")).prepend($compile("<div data-r2base-document-collection data-document-id='"+doc.id+"' data-document-type='"+doc.document_type+"' data-to-populate='true'></div>")(scope))})})}}]),DocumentsDirectives.directive("r2baseDocumentCollection",[function(){return{restrict:"A",templateUrl:function(elem,attr){return"partials/shared/directives/documents/r2base-document-"+attr.documentType.toLowerCase()+"-collection.html"},replace:!0,scope:!0,link:function(scope,element,attrs){scope.loadAll=!1,scope.formNames={RG:["doc_rg_nome","doc_rg_numero","doc_rg_orgao"],CPF:["doc_cpf_nome","doc_cpf_numero"],PASSPORT:["doc_passport_name","doc_passport_number"]},scope.loadAll=!0,void 0!=attrs.toPopulate&&"true"==attrs.toPopulate?scope.$watch("loadAll",function(newVal){if(newVal)switch(scope.index=scope.documentsModel.indexOf(_.findWhere(scope.documentsModel,{id:Number(attrs.documentId)})),scope.documentsModel[scope.index].fields=[],scope.documentsModel[scope.index].sameName=!1,attrs.documentType){case"RG":scope.documentsModel[scope.index].fields[0]=scope.documentsModel[scope.index].field1,scope.documentsModel[scope.index].fields[1]=scope.documentsModel[scope.index].field2,scope.documentsModel[scope.index].fields[2]=scope.documentsModel[scope.index].field3;break;case"CPF":scope.documentsModel[scope.index].fields[0]=scope.documentsModel[scope.index].field1,scope.documentsModel[scope.index].fields[1]=scope.documentsModel[scope.index].field2}}):(scope.documentsModel.push({documentType:attrs.documentType,sameName:!1,fields:[]}),scope.index=scope.documentsModel.length-1),scope.removeElement=function(){setTimeout(function(){scope.$apply(function(){for(i=0;scope.formNames[attrs.documentType];i++)scope.form[scope.formNames[attrs.documentType][i]+"["+scope.index+"]"].$setValidity("required",!0)})},10),scope.documentsModel.splice(scope.index,1),$(element).detach()},scope.$watch("documentsModel["+scope.index+"].sameName",function(newVal,oldVal){var name_field=scope.formNames[attrs.documentType][0];newVal?void 0!=scope.form[name_field+"["+scope.index+"]"]&&(scope.form[name_field+"["+scope.index+"]"].$setValidity("required",!0),scope.documentsModel[scope.index].fields[0]="NOME IGUAL AO DO CADASTRO!"):void 0!=scope.form[name_field+"["+scope.index+"]"]&&(scope.form[name_field+"["+scope.index+"]"].$setValidity("required",!1),scope.documentsModel[scope.index].fields[0]="")}),scope.$watchCollection("documentsModel",function(_newCol,_oldCol,_scope){var element=_oldCol[_scope.index],newIndex=_newCol.indexOf(element);newIndex!==scope.index&&(scope.index=newIndex)})}}}]);var SocialNetworksDirectives=angular.module("SocialNetworksDirectives",[]);SocialNetworksDirectives.run(function($templateCache){$templateCache.removeAll()}),SocialNetworksDirectives.directive("r2baseAddSocialNetworks",[function(){return{restrict:"A",templateUrl:"partials/shared/directives/socialNetworks/r2base-add-social-networks.html",replace:!0,scope:{socialNetworksModel:"=",form:"=",hasEntity:"="}}}]),SocialNetworksDirectives.directive("r2baseBtnAddSocialNetwork",["$compile",function($compile){return function(scope,element,attrs){element.bind("click",function(){angular.element(document.getElementById("section-to-social-networks")).prepend($compile("<div data-r2base-social-network-collection></div>")(scope))})}}]),SocialNetworksDirectives.directive("r2basePopulateSocialNetworks",["$compile","_",function($compile,_){return function(scope,element,attrs){scope.$watch("hasEntity",function(newVal){newVal&&scope.socialNetworksModel.length>0&&_.each(scope.socialNetworksModel,function(socialNetwork){angular.element(document.getElementById("section-to-social-networks")).prepend($compile("<div data-r2base-social-network-collection data-social-network-id='"+socialNetwork.id+"' data-to-populate='true'></div>")(scope))})})}}]),SocialNetworksDirectives.directive("r2baseSocialNetworkCollection",["_",function(_){return{restrict:"A",templateUrl:"partials/shared/directives/socialNetworks/r2base-social-network-collection.html",replace:!0,scope:!0,link:function(scope,element,attrs){void 0!=attrs.toPopulate&&"true"==attrs.toPopulate?scope.index=scope.socialNetworksModel.indexOf(_.findWhere(scope.socialNetworksModel,{id:Number(attrs.socialNetworkId)})):(scope.socialNetworksModel.push({address:null}),scope.index=scope.socialNetworksModel.length-1),scope.removeElement=function(){setTimeout(function(){scope.$apply(function(){scope.form["social_network_address["+scope.index+"]"].$setValidity("required",!0)})},10),scope.socialNetworksModel.splice(scope.index,1),$(element).detach()},scope.$watchCollection("socialNetworksModel",function(_newCol,_oldCol,_scope){var element=_oldCol[_scope.index],newIndex=_newCol.indexOf(element);newIndex!==scope.index&&(scope.index=newIndex)})}}}]);var EmailsDirectives=angular.module("EmailsDirectives",[]);EmailsDirectives.run(function($templateCache){$templateCache.removeAll()}),EmailsDirectives.directive("r2baseAddEmails",[function(){return{restrict:"A",templateUrl:"partials/shared/directives/emails/r2base-add-emails.html",replace:!0,scope:{emailsModel:"=",form:"=",hasEntity:"="}}}]),EmailsDirectives.directive("r2baseBtnAddEmail",["$compile",function($compile){return function(scope,element,attrs){element.bind("click",function(){angular.element(document.getElementById("section-to-emails")).prepend($compile("<div data-r2base-email-collection></div>")(scope))})}}]),EmailsDirectives.directive("r2basePopulateEmails",["$compile","_",function($compile,_){return function(scope,element,attrs){scope.$watch("hasEntity",function(newVal){newVal&&scope.emailsModel.length>0&&_.each(scope.emailsModel,function(email){angular.element(document.getElementById("section-to-emails")).prepend($compile("<div data-r2base-email-collection data-email-id='"+email.id+"' data-to-populate='true'></div>")(scope))})})}}]),EmailsDirectives.directive("r2baseEmailCollection",[function(){return{restrict:"A",templateUrl:"partials/shared/directives/emails/r2base-email-collection.html",replace:!0,scope:!0,link:function(scope,element,attrs){void 0!=attrs.toPopulate&&"true"==attrs.toPopulate?scope.index=scope.emailsModel.indexOf(_.findWhere(scope.emailsModel,{id:Number(attrs.emailId)})):(scope.emailsModel.push({address:null}),scope.index=scope.emailsModel.length-1),scope.removeElement=function(){setTimeout(function(){scope.$apply(function(){scope.form["email_address["+scope.index+"]"].$setValidity("required",!0)})},10),scope.emailsModel.splice(scope.index,1),$(element).detach()},scope.$watchCollection("emailsModel",function(_newCol,_oldCol,_scope){var element=_oldCol[_scope.index],newIndex=_newCol.indexOf(element);newIndex!==scope.index&&(scope.index=newIndex)})}}}]);var CreditCardsDirectives=angular.module("CreditCardsDirectives",[]);CreditCardsDirectives.run(function($templateCache){$templateCache.removeAll()}),CreditCardsDirectives.directive("r2baseAddCreditCards",[function(){return{restrict:"A",templateUrl:"partials//çdirectives/creditCards/r2base-add-creditCards.html",replace:!0,scope:!0,link:function(scope,element){scope.$watch("user.person.creditCards.length",function(newVal,oldVal){scope.qtdeItems=newVal})}}}]),CreditCardsDirectives.directive("r2baseBtnAddCreditCard",["$compile",function($compile){return function(scope,element,attrs){element.bind("click",function(){angular.element(document.getElementById("section-to-credit-cards")).prepend($compile("<div data-r2base-credit-card-collection></div>")(scope))})}}]),CreditCardsDirectives.directive("r2baseCreditCardCollection",[function(){return{restrict:"A",templateUrl:"partials/shared/directives/creditCards/r2base-credit-card.html",replace:!0,scope:!0,link:function(scope,element){scope.user.person.creditCards.push({brand:null,holder:null,number:null,validade:null})}}}]);var TelephonesDirectives=angular.module("TelephonesDirectives",["BaseServices"]);TelephonesDirectives.run(function($templateCache){$templateCache.removeAll()}),TelephonesDirectives.directive("r2baseAddTelephones",[function(){return{restrict:"A",templateUrl:"partials/shared/directives/telephones/r2base-add-telephones.html",replace:!0,scope:{telephonesModel:"=",form:"=",hasEntity:"="}}}]),TelephonesDirectives.directive("r2baseBtnAddTelephone",["$compile",function($compile){return function(scope,element,attrs){element.bind("click",function(){angular.element(document.getElementById("section-to-telephones")).prepend($compile("<div data-r2base-telephone-collection></div>")(scope))})}}]),TelephonesDirectives.directive("r2basePopulateTelephones",["$compile","_",function($compile,_){return function(scope,element,attrs){scope.$watch("hasEntity",function(newVal){newVal&&scope.telephonesModel.length>0&&_.each(scope.telephonesModel,function(telephone){angular.element(document.getElementById("section-to-telephones")).prepend($compile("<div data-r2base-telephone-collection data-telephone-id='"+telephone.id+"' data-to-populate='true'></div>")(scope))})})}}]),TelephonesDirectives.directive("r2baseTelephoneCollection",["BaseEnumsFactory",function(BaseEnumsFactory){return{restrict:"A",templateUrl:"partials/shared/directives/telephones/r2base-telephone-collection.html",replace:!0,scope:!0,link:function(scope,element,attrs){scope.options={telephoneTypes:[],mobileMNOs:[]},scope.loadAll=!1,BaseEnumsFactory.show(function(result){_.each(result.data.telephoneTypes,function(telephoneType){scope.options.telephoneTypes.push({name:telephoneType})}),scope.telephoneTypesLoad=!0,_.each(result.data.mobileMNOs,function(mobileMNO){scope.options.mobileMNOs.push({name:mobileMNO})}),scope.mobileMNOsLoad=!0,scope.loadAll=!0}),void 0!=attrs.toPopulate&&"true"==attrs.toPopulate?scope.$watch("loadAll",function(newVal){newVal&&(scope.index=scope.telephonesModel.indexOf(_.findWhere(scope.telephonesModel,{id:Number(attrs.telephoneId)})),scope.telephonesModel[scope.index].telephoneType=scope.telephonesModel[scope.index].telephone_type,scope.telephonesModel[scope.index].mobileMNO=scope.telephonesModel[scope.index].mobile_mno)}):(scope.telephonesModel.push({telephoneType:null,countryIDD:null,region:null,number:null,mobileMNO:null,extension:null}),scope.index=scope.telephonesModel.length-1),scope.removeElement=function(){setTimeout(function(){scope.$apply(function(){scope.form["tel_telephoneType["+scope.index+"]"].$setValidity("required",!0),scope.form["tel_number["+scope.index+"]"].$setValidity("required",!0)})},10),scope.telephonesModel.splice(scope.index,1),$(element).detach()},scope.$watchCollection("telephonesModel",function(_newCol,_oldCol,_scope){var element=_oldCol[_scope.index],newIndex=_newCol.indexOf(element);newIndex!==scope.index&&(scope.index=newIndex)})}}}]);var AddressesDirectives=angular.module("AddressesDirectives",["underscore","BaseServices"]);AddressesDirectives.run(function($templateCache){$templateCache.removeAll()}),AddressesDirectives.directive("r2baseAddAddresses",[function(){return{restrict:"A",templateUrl:"partials/shared/directives/addresses/r2base-add-addresses.html",replace:!0,scope:{addressesModel:"=",form:"=",hasEntity:"="}}}]),AddressesDirectives.directive("r2baseBtnAddAddress",["$compile",function($compile){return function(scope,element,attrs){element.bind("click",function(){angular.element(document.getElementById("section-to-adresses")).prepend($compile("<div data-r2base-address-collection></div>")(scope))})}}]),TelephonesDirectives.directive("r2basePopulateAddresses",["$compile","_",function($compile,_){return function(scope,element,attrs){scope.$watch("hasEntity",function(newVal){newVal&&scope.addressesModel.length>0&&_.each(scope.addressesModel,function(address){angular.element(document.getElementById("section-to-adresses")).prepend($compile("<div data-r2base-address-collection data-address-id='"+address.id+"' data-to-populate='true'></div>")(scope))})})}}]),AddressesDirectives.directive("r2baseAddressCollection",["_","StatesFactory","CitiesFactory","$http","$q",function(_,StatesFactory,CitiesFactory,$http,$q){return{restrict:"A",templateUrl:"partials/shared/directives/addresses/r2base-address-collection.html",replace:!0,scope:!0,link:function(scope,element,attrs){scope.editableInputSeekCep=!0,scope.statesLoad=!1,scope.stateIsSelected=!1,scope.citiesLoad=!1,scope.loadAll=!1,scope.options={states:[],cities:[]},StatesFactory.show(function(result){_.each(result.data,function(state){scope.options.states.push({id:state.id,name:state.code,ibge_code:state.ibge_code})}),scope.statesLoad=!0,scope.loadAll=!0}),void 0!=attrs.toPopulate&&"true"==attrs.toPopulate?scope.$watch("loadAll",function(newVal){if(newVal){scope.index=scope.addressesModel.indexOf(_.findWhere(scope.addressesModel,{id:Number(attrs.addressId)}));var strStateId=scope.addressesModel[scope.index].state.id.toString();scope.addressesModel[scope.index].state=strStateId;var promise=scope.stateSelectChange(strStateId);promise.then(function(){var city=_.find(scope.options.cities,function(val_city){return val_city.id==scope.addressesModel[scope.index].city.id?val_city:null});return null!==city&&void 0!==city&&(scope.addressesModel[scope.index].city=city.id.toString()),!0})}}):(scope.addressesModel.push({state:null,city:null,neighborhood:null,postcode:null,address1:null,address2:null,number:null,description:null}),scope.index=scope.addressesModel.length-1),scope.stateSelectChange=function(state){var deferred=$q.defer();return state>0&&(scope.options.cities=[],scope.citiesLoad=!1,scope.stateIsSelected=!0,CitiesFactory.getByState({id:state},function(result){_.each(result.data,function(city){scope.options.cities.push({id:city.id,name:city.name})}),scope.citiesLoad=!0,deferred.resolve()})),deferred.promise},scope.removeElement=function(){setTimeout(function(){scope.$apply(function(){scope.form["address_postcode["+scope.index+"]"].$setValidity("required",!0),scope.form["address_state["+scope.index+"]"].$setValidity("required",!0),scope.form["address_city["+scope.index+"]"].$setValidity("required",!0),scope.form["address_neighborhood["+scope.index+"]"].$setValidity("required",!0),scope.form["address_address1["+scope.index+"]"].$setValidity("required",!0),scope.form["address_address2["+scope.index+"]"].$setValidity("required",!0),scope.form["address_number["+scope.index+"]"].$setValidity("required",!0)})},10),scope.addressesModel.splice(scope.index,1),$(element).detach()},scope.$watch("addressesModel["+scope.index+"].postcode",function(newVal,oldVal){if(void 0!=newVal){scope.editableInputSeekCep=!1;var promise=null;$http.get("http://api.postmon.com.br/v1/cep/"+newVal).then(function(response){var endereco=response.data,state=_.find(scope.options.states,function(val_state){return val_state.name==endereco.estado?val_state:void 0});void 0!==state&&null!==state&&(scope.addressesModel[scope.index].state=state.id.toString(),promise=scope.stateSelectChange(state.id),promise.then(function(){var city=_.find(scope.options.cities,function(val_city){return val_city.id==Number(endereco.cidade_info.codigo_ibge.substr(0,6))?val_city:null});return null!==city&&void 0!==city&&(scope.addressesModel[scope.index].city=city.id.toString()),scope.addressesModel[scope.index].neighborhood=endereco.bairro,scope.addressesModel[scope.index].address1=endereco.logradouro,!0}).then(function(){scope.editableInputSeekCep=!0}))})}else scope.editableInputSeekCep=!0})}}}]),AddressesDirectives.directive("r2baseAddressUnique",["_","StatesFactory","CitiesFactory","$http","$q",function(_,StatesFactory,CitiesFactory,$http,$q){return{restrict:"A",templateUrl:"partials/shared/directives/addresses/r2base-address-unique.html",replace:!0,scope:{addressModel:"=",form:"=",hasEntity:"="},link:function(scope,element){scope.editableInputSeekCep=!0,scope.cities=[],scope.stateIsSelected=!1,scope.cities=[],scope.statesLoad=!1,scope.loadAll=!1,scope.options={states:[],cities:[]},StatesFactory.show(function(result){_.each(result.data,function(state){scope.options.states.push({id:state.id,name:state.code})}),scope.statesLoad=!0,scope.loadAll=!0}),scope.stateSelectChange=function(state){var deferred=$q.defer();return state>0&&(scope.options.cities=[],scope.citiesLoad=!1,scope.stateIsSelected=!0,CitiesFactory.getByState({id:state},function(result){_.each(result.data,function(city){scope.options.cities.push({id:city.id,name:city.name})}),scope.citiesLoad=!0,deferred.resolve()})),deferred.promise},scope.$watch("addressModel.postcode",function(newVal,oldVal){console.log("POST CODE",newVal),void 0!=newVal?(scope.editableInputSeekCep=!1,$http.get("http://api.postmon.com.br/v1/cep/"+newVal).then(function(response){var endereco=response.data,state=_.find(scope.options.states,function(val_state){return val_state.name==endereco.estado?val_state:void 0});if(void 0!==state&&null!==state){scope.addressModel.state=state.id.toString();var promise=scope.stateSelectChange(state.id);promise.then(function(){var city=_.find(scope.options.cities,function(val_city){return val_city.id==Number(endereco.cidade_info.codigo_ibge.substr(0,6))?val_city:null});return null!==city&&void 0!==city&&(scope.addressModel.city=city.id.toString()),scope.addressModel.neighborhood=endereco.bairro,scope.addressModel.address1=endereco.logradouro,!0}).then(function(){scope.editableInputSeekCep=!0})}})):scope.editableInputSeekCep=!0})}}}]);var LanguageSelectDirective=angular.module("LanguageSelectDirective",[]);LanguageSelectDirective.directive("ngTranslateLanguageSelect",function(LocaleService){return{restrict:"A",replace:!0,template:'<div class="language-select" ng-if="visible"><label>{{"directives.language-select.Language" | translate}}:<select ng-model="currentLocaleDisplayName"ng-options="( localesDisplayName | translate ) for localesDisplayName in localesDisplayNames"ng-change="changeLanguage(currentLocaleDisplayName)"></select></label></div>',controller:function($scope){$scope.currentLocaleDisplayName=LocaleService.getLocaleDisplayName(),$scope.localesDisplayNames=LocaleService.getLocalesDisplayNames(),$scope.visible=$scope.localesDisplayNames&&$scope.localesDisplayNames.length>1,$scope.changeLanguage=function(locale){LocaleService.setLocaleByDisplayName(locale)}}}});var ValidationDirectives=angular.module("ValidationDirectives",[]);ValidationDirectives.directive("r2CompareTo",function(){return{require:"ngModel",replace:!1,scope:!1,link:function(scope,element,attributes,ngModel){ngModel.$validators.r2CompareTo=function(modelValue){return modelValue===scope.formCtrl.user_password.$modelValue},scope.$watch("formCtrl.user_password.$modelValue",function(){ngModel.$validate()})}}}),ValidationDirectives.directive("r2UniqueUser",["CheckUniqueUserFactory","$q",function(CheckUniqueUserFactory,$q){return{require:"ngModel",link:function(scope,element,attributes,ngModel){var RE_EMAIL=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i;ngModel.$asyncValidators.r2UniqueUser=function(modelValue){if(RE_EMAIL.test(modelValue)){$q.defer();return CheckUniqueUserFactory.show({user:modelValue}).$promise.then(function(result){return result.data?$q.reject():!0})}}}}}]),ValidationDirectives.directive("dynAttr",["$compile",function($compile){return{link:function(scope,elem,attrs){elem.attr("ui-br-cpf-mask")}}}]);var InputDirectives=angular.module("InputDirectives",[]);InputDirectives.directive("r2InputDisabled",function(){return function(scope,element,attrs){console.log("R2 INPUT ATTR",attrs.r2InputDisabled),scope.$watch(attrs.r2InputDisabled,function(val){val?element.removeAttr("disabled"):element.attr("disabled","disabled")})}}),InputDirectives.directive("r2HttpPrefix",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,controller){function ensureHttpPrefix(value){return value&&!/^(https?):\/\//i.test(value)&&-1==="http://".indexOf(value)?(controller.$setViewValue("http://"+value),controller.$render(),"http://"+value):value}controller.$formatters.push(ensureHttpPrefix),controller.$parsers.splice(0,0,ensureHttpPrefix)}}});var UsersDirectives=angular.module("UsersDirectives",["underscore","BaseServices"]);UsersDirectives.run(function($templateCache){$templateCache.removeAll()}),UsersDirectives.directive("r2userUserUnique",["_","BaseEnumsFactory","CheckUniqueUserFactory",function(_,BaseEnumsFactory,CheckUniqueUserFactory){return{restrict:"A",templateUrl:"partials/shared/directives/users/r2user-user-unique.html",replace:!0,scope:{userModel:"=",form:"=",hasEntity:"="},link:function(scope,element,attrs){scope.changePassword=!0,scope.showChangePassword=function(){scope.changePassword=!0},scope.$watch("hasEntity",function(newVal){newVal&&(scope.changePassword=!1,scope.originalUser=scope.userModel.user,scope.userModel.password="",scope.userModel.confpassword="")}),scope.$watch("[userModel.user,hasEntity]",function(newVal){var RE_EMAIL=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i,validateUser=!0;newVal[0]&&newVal[1]&&(validateUser=newVal[0]!=scope.originalUser),console.log(),RE_EMAIL.test(newVal[0])&&validateUser&&CheckUniqueUserFactory.show({user:newVal[0]},function(result){result.data?scope.form.access_user.$setValidity("unique",!1):scope.form.access_user.$setValidity("unique",!0)})})}}}]);var BaseServices=angular.module("BaseServices",["ngResource"]);BaseServices.factory("BaseEnumsFactory",["$resource",function($resource){return $resource("/api/base/getenums/:id",{format:"json",jsoncallback:"JSON_CALLBACK"},{show:{method:"GET",isArray:!1,ignoreLoadingBar:!0},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),BaseServices.factory("CountriesIDDFactory",["$resource",function($resource){return $resource("/api/base/countriesidd/:id",{},{show:{method:"GET",isArray:!1},save:{method:"POST"
},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),BaseServices.factory("CountriesFactory",["$resource",function($resource){return $resource("/api/base/countries/:id",{},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),BaseServices.factory("StatesFactory",["$resource",function($resource){return $resource("/api/base/states/:id",{},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),BaseServices.factory("CitiesFactory",["$resource",function($resource){return $resource("/api/base/cities/:id",{},{show:{method:"GET",isArray:!1},save:{method:"POST"},getByState:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var UserServices=angular.module("UserServices",["ngResource"]);UserServices.factory("UsersFactory",["$resource",function($resource){function resourceErrorHandler(response){console.log("ERRO",response)}return $resource("/api/user/users/:id",{id:"@id"},{show:{method:"GET",isArray:!1,interceptor:{responseError:resourceErrorHandler}},save:{method:"POST",interceptor:{responseError:resourceErrorHandler}},update:{method:"PUT",params:{id:"@id"},interceptor:{responseError:resourceErrorHandler}},"delete":{method:"DELETE",params:{id:"@id"},interceptor:{responseError:resourceErrorHandler}}})}]),UserServices.factory("CheckUniqueUserFactory",["$resource",function($resource){return $resource("/api/user/uniqueuser/:user",{},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),UserServices.factory("ForgotPassFactory",["$resource",function($resource){return $resource("/api/user/forgot-password/:user",{},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var AclServices=angular.module("AclServices",["ngResource"]);AclServices.factory("RolesFactory",["$resource",function($resource){return $resource("/api/acl/roles/:id",{format:"json",jsoncallback:"JSON_CALLBACK"},{show:{method:"GET",isArray:!1,ignoreLoadingBar:!0},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var LocaleServices=angular.module("LocaleServices",[]);LocaleServices.service("LocaleService",function($translate,LOCALES,$rootScope,tmhDynamicLocale){var localesObj=LOCALES.locales,_LOCALES=Object.keys(localesObj);_LOCALES&&0!==_LOCALES.length||console.error("There are no _LOCALES provided");var _LOCALES_DISPLAY_NAMES=[];_LOCALES.forEach(function(locale){_LOCALES_DISPLAY_NAMES.push(localesObj[locale])});var currentLocale=$translate.proposedLanguage(),checkLocaleIsValid=function(locale){return-1!==_LOCALES.indexOf(locale)},setLocale=function(locale){return checkLocaleIsValid(locale)?(currentLocale=locale,void $translate.use(locale)):void console.error('Locale name "'+locale+'" is invalid')};return $rootScope.$on("$translateChangeSuccess",function(event,data){document.documentElement.setAttribute("lang",data.language),tmhDynamicLocale.set(data.language.toLowerCase().replace(/_/g,"-"))}),{getLocaleDisplayName:function(){return localesObj[currentLocale]},setLocaleByDisplayName:function(localeDisplayName){setLocale(_LOCALES[_LOCALES_DISPLAY_NAMES.indexOf(localeDisplayName)])},getLocalesDisplayNames:function(){return _LOCALES_DISPLAY_NAMES}}});var InventoriesServices=angular.module("InventoriesServices",["ngResource"]);InventoriesServices.factory("StoresFactory",["$resource",function($resource){return $resource("/api/erp/order/stores/:id",{id:"@id",format:"json",jsoncallback:"JSON_CALLBACK"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),InventoriesServices.factory("ComboStoresFactory",["$resource",function($resource){return $resource("/api/erp/order/combostores/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),InventoriesServices.factory("OrderSalesFactory",["$resource",function($resource){return $resource("/api/erp/order/sale-orders/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),InventoriesServices.factory("SalesFactory",["$resource",function($resource){return $resource("/api/erp/order/sales/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var CheckoutServices=angular.module("CheckoutServices",["ngResource"]);CheckoutServices.factory("BoletoBradescoFactory",["$resource",function($resource){return $resource("/api/erp/checkout/boleto-bradesco/:id",{id:"@id",format:"json",jsoncallback:"JSON_CALLBACK"},{show:{method:"GET",isArray:!1,ignoreLoadingBar:!0},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),CheckoutServices.factory("PagseguroFactory",["$resource",function($resource){return $resource("/api/erp/checkout/pagseguro/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),CheckoutServices.factory("TestReturnFactory",["$resource",function($resource){return $resource("/api/erp/checkout/testreturn/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),CheckoutServices.factory("CieloFactory",["$resource",function($resource){return $resource("/api/erp/checkout/cielo/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),CheckoutServices.factory("CalcFreteFactory",["$resource",function($resource){return $resource("/api/base/calcfrete/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var NotificationServices=angular.module("NotificationServices",["ngResource"]);NotificationServices.factory("NotificationPagseguroFactory",["$resource",function($resource){return $resource("/api/erp/notification/pagseguro/:id",{id:"@id",format:"json",jsoncallback:"JSON_CALLBACK"},{show:{method:"GET",isArray:!1,ignoreLoadingBar:!0},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]),NotificationServices.factory("NotificationCieloFactory",["$resource",function($resource){return $resource("/api/erp/notification/cielo/:id",{id:"@id",format:"json",jsoncallback:"JSON_CALLBACK"},{show:{method:"GET",isArray:!1,ignoreLoadingBar:!0},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var CouponServices=angular.module("CouponServices",["ngResource"]);CouponServices.factory("CouponsFactory",["$resource",function($resource){return $resource("/api/erp/product/discountcoupons/:id",{id:"@id"},{show:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE",params:{id:"@id"}}})}]);var messages={required:"Este campo é obrigatório",minlength:"Muito curto! Tamanho mínimo de @value@ caracteres.",pattern:"Não é um valor válido",email:"Não é um email válido",number:"Insira apenas números",r2CompareTo:"A senha e confirmação de senha precisam ser iguais.",r2UniqueUser:"Este usuário já está sendo utilizado.",cpf:"Número de cpf inválido.",cnpj:"Número de cnpj inválido.","brPhoneNumber ":"Número de telefone inválido(coloque o DDD).","cep ":"Cep inválido."},R2Site=angular.module("R2Site",["AuthModule","underscore","PagSeguroDirectPayment","ngResource","ngCookies","ui.router","ngMessages","favicon","ui.utils.masks","ncy-angular-breadcrumb","ui-notification","ngCart","ngDialog","ngAnimate","ngTouch","ngFloatingLabels","ezplus","youtube-embed","vcRecaptcha","credit-cards","slugifier","blockUI","smart-table","PluginsDirectives","DocumentsDirectives","SocialNetworksDirectives","EmailsDirectives","CreditCardsDirectives","TelephonesDirectives","AddressesDirectives","LanguageSelectDirective","ValidationDirectives","InputDirectives","UsersDirectives","BaseServices","AclServices","UserServices","LocaleServices","InventoriesServices","CheckoutServices","NotificationServices","CouponServices","StringFilters"]).constant("LOCALES",{locales:{pt_BR:"Portuguese",en_US:"English"},preferredLocale:"pt_BR"});R2Site.config(["$locationProvider","$stateProvider","$urlRouterProvider","$provide","$httpProvider",function($locationProvider,$stateProvider,$urlRouterProvider,$provide,$httpProvider){$locationProvider.html5Mode({enabled:!0}),$httpProvider.defaults.withCredentials=!0,$urlRouterProvider.otherwise("/"),$stateProvider.state("root",{url:"/",views:{header:{templateUrl:"/partials/site/layout/header.html",controller:"HeaderCtrl"},banner:{templateUrl:"/partials/site/layout/banner.html",controller:"BannerCtrl"},content:{templateUrl:"/partials/site/pages/home/home.html",controller:"HomeCtrl"},footer:{templateUrl:"/partials/site/layout/footer.html"}},ncyBreadcrumb:{label:"Home"}}).state("root.checkout",{url:"meu-carrinho",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/checkout/home.html",resolve:{PagseguroFactory:"PagseguroFactory",sessionPagseguroId:function(PagseguroFactory){return PagseguroFactory.show().$promise}},controller:"CheckoutCtrl"}},ncyBreadcrumb:{label:"Meu Carrinho"}}).state("root.quemsomos",{url:"pagina/quem-somos/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/quem-somos.html"}},ncyBreadcrumb:{label:"Quem Somos"}}).state("root.assistencia",{url:"pagina/assistencia-tecnica/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/assistencia.html"}},ncyBreadcrumb:{label:"Assisténcia Técnica"}}).state("root.politicas",{url:"pagina/politicas/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/politicas.html"}},ncyBreadcrumb:{label:"Políticas"}}).state("root.faq",{url:"pagina/faq/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/faq.html"}},ncyBreadcrumb:{label:"Faq"}}).state("root.faleconosco",{url:"pagina/fale-conosco/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/contato.html"}},ncyBreadcrumb:{label:"Fale Conosco"}}).state("root.informacoes",{url:"pagina/informacoes/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/informacoes.html"}},ncyBreadcrumb:{label:"Informações"}}).state("root.revendedores",{url:"pagina/revendedores/",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/singles/revendedores.html"}},ncyBreadcrumb:{label:"Informações"}}).state("root.productsdetails",{url:"produto/:storeId/:slug",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/product/detail.html",resolve:{StoresFactory:"StoresFactory",store:function(StoresFactory,$stateParams){var storeId=$stateParams.storeId;return StoresFactory.show({id:storeId}).$promise}},controller:"StoreDetailCtrl"}},ncyBreadcrumb:{label:"Detalhe Produto"}}).state("root.combodetails",{url:"combo/:comboStoreId/:slug",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/combos/detail.html",resolve:{ComboStoresFactory:"ComboStoresFactory",comboStore:function(ComboStoresFactory,$stateParams){var comboStoreId=$stateParams.comboStoreId;return ComboStoresFactory.show({id:comboStoreId}).$promise}},controller:"ComboStoreDetailCtrl"}},ncyBreadcrumb:{label:"Detalhe Produto"}}).state("root.departments",{url:"departamentos/:departmentName",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/departments/home.html",controller:"DepartmentsCtrl"}},ncyBreadcrumb:{label:"{{departmentName}}"}}).state("root.searchProducts",{url:"procurar-produto/:search",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/search/home.html",controller:"SearchProductsCtlr"}},ncyBreadcrumb:{label:"{{departmentName}}"}}).state("root.launchs",{url:"lancamentos",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/launchs/home.html",controller:"LaunchsCtrl"}},ncyBreadcrumb:{label:"Lançamentos"}}).state("root.combos",{url:"combos",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/combos/home.html",controller:"CombosCtrl"}},ncyBreadcrumb:{label:"Combos"}}).state("root.pagsegurocomprafinalizada",{url:"pagseguro/compra-finalizada",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/checkout/compra-finalizada.html",controller:"PagseguroCompraFinalizadaCtrl"}},ncyBreadcrumb:{label:"Compra Finalizada"}}).state("root.userregister",{url:"usuario/registro",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/user/register/form.html",controller:"CreateUserCtrl"}},ncyBreadcrumb:{label:"Cadastro de Cliente"}}).state("root.usercompras",{url:"usuario/pagina/minhas-compras",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/user/minhas-compras/home.html",controller:"ComprasUserCtrl"}},ncyBreadcrumb:{label:"Minhas Compras"}}).state("root.userconta",{url:"usuario/pagina/minha-conta",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/user/minha-conta/home.html",controller:"ContaUserCtrl"}},ncyBreadcrumb:{label:"Minha Conta"}}).state("root.userchangepassword",{url:"recadastrar-senha/:key",views:{"banner@":{template:'<img src="/img/barra-verde.png" width="100%">'},"content@":{templateUrl:"/partials/site/pages/user/recadastrar-senha/home.html",controller:"RecadastrarSenhaCtrl"}},ncyBreadcrumb:{label:"Minha Conta"}}).state("root.userregister.access",{url:"/acesso",views:{"form_user@root.userregister":{templateUrl:"/partials/site/pages/user/register/form-access.html"}}}).state("root.userregister.personal",{url:"/dados-pessoais",views:{"form_user@root.userregister":{templateUrl:"/partials/site/pages/user/register/form-personal.html"}}}).state("root.userregister.contact",{url:"/contatos",views:{"form_user@root.userregister":{templateUrl:"/partials/site/pages/user/register/form-contacts.html"}}}).state("root.userregister.address",{url:"/endereco",views:{"form_user@root.userregister":{templateUrl:"/partials/site/pages/user/register/form-address.html"}}}).state("root.userregister.register",{url:"/registrar",views:{"form_user@root.userregister":{templateUrl:"/partials/site/pages/user/register/form-register.html"}}}).state("redirect",{url:"redirect/:to",controller:function($state,$stateParams,$scope){$state.go($stateParams.to,null,{reload:!0})}})}]),R2Site.run(["$rootScope","$templateCache","$state",function($rootScope,$templateCache,$state){if(console.log("nav",navigator),-1!=navigator.appName.indexOf("Internet Explorer")){var badBrowser=-1==navigator.appVersion.indexOf("MSIE 9")&&-1==navigator.appVersion.indexOf("MSIE 1");badBrowser&&(console.log("IE < 9"),$rootScope.$broadcast("badNavigator",!1))}$rootScope.$on("$viewContentLoaded",function(){$templateCache.removeAll()})}]),R2Site.controller("HeaderCtrl",["$scope","ngDialog","StoresFactory","AuthService","$state","Slug","blockUI","$rootScope",function($scope,ngDialog,StoresFactory,AuthService,$state,Slug,blockUI,$rootScope){function getImgCover(images){var cover=_.find(images,function(image){return image.isCover?!0:void 0});return cover}blockUI.start(),$scope.badNavigator=!1,$rootScope.$on("badNavigator",function(event,next,current){$scope.badNavigator=!0}),$scope.userLogged=!1,$scope.searchProduct="",AuthService.isAuthenticated()&&($scope.userLogged=!0,$scope.userName=AuthService.getUserName()),$scope.loginShow=function(){ngDialog.openConfirm({template:"/partials/site/pages/user/login/form.html",controller:"LoginCtrl",className:"ngdialog-theme-default",closeByEscape:!0,closeByDocument:!0}).then(function(value){console.log("VALUE",value)})["catch"](function(value){console.log("CATCH",value)})},$scope.logout=function(){AuthService.logout(),$state.go("root",{},{reload:!0})},$scope.searchProducts=function(){console.log("PROCURAR POR",$scope.searchProduct),$state.go("root.searchProducts",{search:$scope.searchProduct})},$scope.storesDeptLimpeza=[],$scope.storesDeptEletro=[],$scope.storesDeptFerram=[],$scope.storesDeptPecas=[],$scope.storeDetailLimpeza={},$scope.storeDetailEletro={},$scope.storeDetailFerram={},$scope.storeDetailPecas={},$scope.selectStoreDetailLancamento=function(store){store.slug=Slug.slugify(store.product.title),$scope.storeDetailLancamento=store},$scope.selectStoreDetailLimpeza=function(store){store.slug=Slug.slugify(store.product.title),$scope.storeDetailLimpeza=store},$scope.selectStoreDetailEletro=function(store){store.slug=Slug.slugify(store.product.title),$scope.storeDetailEletro=store},$scope.selectStoreDetailFerram=function(store){store.slug=Slug.slugify(store.product.title),$scope.storeDetailFerram=store},$scope.selectStoreDetailPecas=function(store){store.slug=Slug.slugify(store.product.title),$scope.storeDetailPecas=store},StoresFactory.show(function(result){if(console.log("STORES FACTORY HEADER LAYOUT",result),result.success){var i=0,limit=5;$scope.storesDeptLimpeza=_.filter(result.data,function(store){return"ROBÔS DE LIMPEZA"===store.product.department.name&&limit>i?(0==i&&(store.slug=Slug.slugify(store.product.title),$scope.storeDetailLimpeza=store),i++,store.cover=getImgCover(store.product.images),!0):void 0});var i=0;$scope.storesDeptLancamento=_.filter(result.data,function(store){return void 0!==store.product.isLaunch&&limit>i&&store.product.isLaunch?(0==i&&(store.slug=Slug.slugify(store.product.title),$scope.storeDetailLancamento=store),i++,store.cover=getImgCover(store.product.images),!0):void 0}),i=0,$scope.storesDeptEletro=_.filter(result.data,function(store){return"ELETRODOMÉSTICOS"===store.product.department.name&&3>i?(0==i&&(store.slug=Slug.slugify(store.product.title),$scope.storeDetailEletro=store),i++,store.cover=getImgCover(store.product.images),!0):void 0}),i=0,$scope.storesDeptFerram=_.filter(result.data,function(store){return"FERRAMENTAS"===store.product.department.name&&limit>i?(0==i&&(store.slug=Slug.slugify(store.product.title),$scope.storeDetailFerram=store),i++,store.cover=getImgCover(store.product.images),!0):void 0}),i=0,$scope.storesDeptPecas=_.filter(result.data,function(store){return"PEÇAS DE REPOSIÇÃO"===store.product.department.name&&limit>i?(0==i&&(store.slug=Slug.slugify(store.product.title),$scope.storeDetailPecas=store),i++,store.cover=getImgCover(store.product.images),!0):void 0})}blockUI.stop()})}]),R2Site.controller("HomeCtrl",["$scope","StoresFactory","Slug","blockUI",function($scope,StoresFactory,Slug,blockUI){blockUI.start(),$scope.storesHighlighted=[],$scope.storesSoldMore=[],StoresFactory.show({toSell:!0},function(result){if(console.log("STORES FACTORY HOME LAYOUT",result),result.success){console.log("RESULT",result),result.data=_.reject(result.data,function(store){return store.slug=Slug.slugify(store.product.title),store.sellDiscountPrice?store.price=store.unitDiscountPrice:store.price=store.unitPrice,"PEÇAS DE REPOSIÇÃO"===store.product.department.name?!0:void 0});for(var qtdeHL=4,listHL=_.filter(result.data,function(store){return store.slug=Slug.slugify(store.product.title),store.product.isHighlighted?!0:void 0}),i=0;qtdeHL>i;i++){$scope.storesHighlighted[i]=listHL[i];var cover=_.find(listHL[i].product.images,function(image){return image.isCover?!0:void 0});$scope.storesHighlighted[i].cover=cover,result.data=_.reject(result.data,function(store){return $scope.storesHighlighted[i].id===store.id})}for(var qtdeSM=4,listSM=_.filter(result.data,function(store){return store.slug=Slug.slugify(store.product.title),!0}),i=0;qtdeSM>i;i++){$scope.storesSoldMore[i]=listSM[i];var cover=_.find(listSM[i].product.images,function(image){return image.isCover?!0:void 0});$scope.storesSoldMore[i].cover=cover,result.data=_.reject(result.data,function(store){return $scope.storesSoldMore[i].id===store.id})}}blockUI.stop()})}]),R2Site.controller("BannerCtrl",["$scope","$timeout",function($scope,$timeout){var INTERVAL=7e3;$scope.slides=[{image:"/img/banners/banner-04.jpg",description:"Imagem 1"},{image:"/img/banners/banner-05.jpg",description:"Imagem 2"},{image:"/img/banners/banner-06.jpg",description:"Imagem 3"},{image:"/img/banners/banner-07.jpg",description:"Imagem 4"}],$scope.direction="left",$scope.currentIndex=0,$scope.setCurrentSlideIndex=function(index){$scope.direction=index>$scope.currentIndex?"left":"right",$scope.currentIndex=index},$scope.isCurrentSlideIndex=function(index){return $scope.currentIndex===index},$scope.prevSlide=function(){$scope.direction="left",$scope.currentIndex=$scope.currentIndex<$scope.slides.length-1?++$scope.currentIndex:0},$scope.nextSlide=function(){$scope.direction="right",$scope.currentIndex=$scope.currentIndex>0?--$scope.currentIndex:$scope.slides.length-1},$timeout($scope.nextSlide,INTERVAL)}]).animation(".slide-animation",function(){return{beforeAddClass:function(element,className,done){var scope=element.scope();if("ng-hide"==className){var finishPoint=element.parent().width();console.log("ELEM IMG",element.context.currentSrc),"right"!==scope.direction&&(finishPoint=-finishPoint),TweenMax.to(element,1,{left:finishPoint,onComplete:done,ease:Power2.easeInOut,opacity:0})}else done()},removeClass:function(element,className,done){var scope=element.scope();if("ng-hide"==className){element.removeClass("ng-hide");var startPoint=element.parent().width();"right"===scope.direction&&(startPoint=-startPoint),TweenMax.fromTo(element,1,{left:startPoint,ease:Power2.easeInOut},{left:0,onComplete:done,opacity:1})}else done()}}}),R2Site.controller("LoginCtrl",["$scope","$state","AuthService","AUTH_EVENTS","$rootScope","ForgotPassFactory","Notification",function($scope,$state,AuthService,AUTH_EVENTS,$rootScope,ForgotPassFactory,Notification){$scope.user={},$scope.senhaErrada=!1,$scope.forgotPassword=function(){$scope.enviandoEmail=!0,ForgotPassFactory.get({user:$scope.user.user},function(result){console.log("forgt. res",result),result.success&&Notification.success({message:"Verifique o seu e-mail para recadastrar uma nova senha.",title:"E-mail Enviado Com Sucesso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.enviandoEmail=!1,$scope.confirm(0)})},$scope.login=function(){AuthService.login($scope.user.user,$scope.user.password).then(function(authenticated){AUTH_EVENTS.notAuthenticated!==authenticated.result&&($scope.confirm(authenticated),$state.go("root",{},{reload:!0}))})},$rootScope.$on("notLogged",function(args){console.log("1",args),$scope.senhaErrada=!0})}]),R2Site.controller("CreateUserCtrl",["$scope","$state","BaseEnumsFactory","StatesFactory","CitiesFactory","$http","$q","UsersFactory","Notification","ngDialog",function($scope,$state,BaseEnumsFactory,StatesFactory,CitiesFactory,$http,$q,UsersFactory,Notification,ngDialog){$scope.options={telephoneTypes:[],states:[],cities:[]},$scope.editableInputSeekCep=!0,$scope.statesLoad=!1,$scope.stateIsSelected=!1,$scope.citiesLoad=!1,$scope.loadAll=!1,$scope.user={customerType:"PHYSICAL",person:{name:"",surname:"",documents:[{documentType:"CPF",field1:""},{documentType:"CNPJ",field1:""}],telephones:[{}],addresses:[{}]}};var oriUser=angular.copy($scope.user);BaseEnumsFactory.show(function(result){_.each(result.data.telephoneTypes,function(telephoneType){$scope.options.telephoneTypes.push({name:telephoneType})})}),StatesFactory.show(function(result){_.each(result.data,function(state){$scope.options.states.push({id:state.id,name:state.code,ibge_code:state.ibge_code})}),$scope.statesLoad=!0}),$scope.stateSelectChange=function(state){var deferred=$q.defer();return state>0&&($scope.options.cities=[],$scope.citiesLoad=!1,$scope.stateIsSelected=!0,CitiesFactory.show({stateId:state},function(result){console.log("CIDADES",result),_.each(result.data,function(city){$scope.options.cities.push({id:city.id,name:city.name})}),$scope.citiesLoad=!0,deferred.resolve()})),deferred.promise},$scope.nextStep=function(step){switch($scope.stepForm=step,step){case 2:$state.go("root.userregister.personal");break;case 3:$state.go("root.userregister.contact");break;case 4:$state.go("root.userregister.address");break;case 5:$state.go("root.userregister.register")}},$scope.$watch("user.customerType",function(newVal){"PHYSICAL"==newVal?($scope.user.person.name="",$scope.user.person.surname="",$scope.user.person.documents[0].field1="",$scope.user.person.documents[1].field1="",$scope.phPersonName="Nome Completo",$scope.phPersonDocument="CPF",void 0!=$scope.userForm.person_surname&&($scope.userForm.person_surname.$setValidity("required",!0),$scope.userForm.person_document_cnpj.$setValidity("required",!0),$scope.userForm.person_document_cnpj.$setValidity("cnpj",!0),$scope.userForm.person_document_cpf.$setValidity("required",!1),$scope.userForm.person_document_cpf.$setValidity("cpf",!1))):"LEGAL"==newVal&&($scope.user.person.name="",$scope.user.person.surname="",$scope.user.person.documents[0].field1="",$scope.user.person.documents[1].field1="",$scope.phPersonName="Nome Completo",$scope.phPersonSurname="Razão Social",$scope.phPersonDocument="CNPJ",$scope.userForm.person_surname.$setValidity("required",!1),$scope.userForm.person_document_cnpj.$setValidity("required",!1),$scope.userForm.person_document_cnpj.$setValidity("cnpj",!1),$scope.userForm.person_document_cpf.$setValidity("required",!0),$scope.userForm.person_document_cpf.$setValidity("cpf",!0))}),$scope.$watchCollection("userForm.person_surname",function(newVal){void 0!=newVal&&"PHYSICAL"==$scope.user.customerType&&($scope.userForm.person_surname.$setValidity("required",!0),$scope.userForm.person_document_cnpj.$setValidity("required",!0),$scope.userForm.person_document_cnpj.$setValidity("cnpj",!0),$scope.userForm.person_document_cpf.$setValidity("required",!1),$scope.userForm.person_document_cpf.$setValidity("cpf",!1))}),$scope.$watch("user.person.addresses[0].postcode",function(newVal,oldVal){if(void 0!=newVal){$scope.editableInputSeekCep=!1;var promise=null,callCep="https://api.postmon.com.br/v1/cep/"+newVal;$http.jsonp(callCep+"?callback=JSON_CALLBACK").then(function(response){var endereco=response.data,state=_.find($scope.options.states,function(val_state){return val_state.name==endereco.estado?val_state:void 0});void 0!==state&&null!==state&&($scope.user.person.addresses[0].state=state.id.toString(),promise=$scope.stateSelectChange(state.id),promise.then(function(){var city=_.find($scope.options.cities,function(val_city){return val_city.id==Number(endereco.cidade_info.codigo_ibge.substr(0,6))?val_city:null});return null!==city&&void 0!==city&&($scope.user.person.addresses[0].city=city.id.toString()),$scope.user.person.addresses[0].neighborhood=endereco.bairro,$scope.user.person.addresses[0].address1=endereco.logradouro,!0}).then(function(){$scope.editableInputSeekCep=!0}))})}else $scope.editableInputSeekCep=!0}),$scope.userRegister=function(){UsersFactory.save($scope.user,function(result){result.success&&(Notification.success({message:"Você está apto a realizar a sua identifação em nosso site.",title:"Cliente Cadastrado Com Sucesso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.userReset(),$state.go("root.checkout"))})},$scope.goToSetOne=function(){$scope.stepForm=1,$state.go("root.userregister.access")},$scope.userReset=function(){$scope.user=angular.copy(oriUser),$scope.userForm.$setPristine()},$scope.goToSetOne()}]),R2Site.controller("ComprasUserCtrl",["$scope","OrderSalesFactory","AuthService","Notification","ngDialog",function($scope,OrderSalesFactory,AuthService,Notification,ngDialog){$scope.itemsByPage=5,AuthService.isAuthenticated()?OrderSalesFactory.show({customerId:AuthService.getUserId()},function(result){console.log("ORDERS",result),$scope.comprasCollection=result.data,$scope.displayedCollection=[].concat($scope.comprasCollection)}):Notification.error({message:"Você precisa estar logado para ver as suas compras.",title:"Aviso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.verCarrinho=function(sales){$scope.sales=sales,ngDialog.open({template:"partials/site/pages/user/minhas-compras/carrinho.html",className:"ngdialog-theme-default",appendClassName:"r2-cart-minhas-compras-dialog",controller:"MeuCarrinhoUserCtrl",scope:$scope})}}]),R2Site.controller("MeuCarrinhoUserCtrl",["$scope","UsersFactory","_",function($scope,UsersFactory,_){_.each($scope.sales,function(sale){if(void 0!==sale.store){console.log("STORE...");var cover=_.find(sale.store.product.images,function(image){return image.isCover?!0:void 0});sale.cover=cover,sale.title=sale.store.product.title}else void 0!==sale.comboStore&&(console.log("COMBO STORE..."),sale.cover=sale.comboStore.comboProduct.thumbnail,sale.title=sale.comboStore.comboProduct.title)}),console.log("SALES",$scope.sales),$scope.displayedCollection=$scope.sales}]),R2Site.controller("ContaUserCtrl",["$scope","UsersFactory","AuthService","Notification","$state","StatesFactory","CitiesFactory","$http","$q",function($scope,UsersFactory,AuthService,Notification,$state,StatesFactory,CitiesFactory,$http,$q){$scope.user={password:""},$scope.options={telephoneTypes:[],states:[],cities:[]},$scope.hasUser=!1,$scope.stateSelectChange=function(state){var deferred=$q.defer();return state>0&&($scope.options.cities=[],$scope.citiesLoad=!1,$scope.stateIsSelected=!0,CitiesFactory.show({stateId:state},function(result){console.log("CIDADES",result),_.each(result.data,function(city){$scope.options.cities.push({id:city.id,name:city.name})}),$scope.citiesLoad=!0,deferred.resolve()})),deferred.promise},StatesFactory.show(function(result){_.each(result.data,function(state){$scope.options.states.push({id:state.id,name:state.code,ibge_code:state.ibge_code})}),$scope.statesLoad=!0}),$scope.$watch("user.person.addresses[0].postcode",function(newVal,oldVal){if(void 0!=newVal){$scope.editableInputSeekCep=!1;var promise=null,callCep="https://api.postmon.com.br/v1/cep/"+newVal;$http.jsonp(callCep+"?callback=JSON_CALLBACK").then(function(response){var endereco=response.data,state=_.find($scope.options.states,function(val_state){return val_state.name==endereco.estado?val_state:void 0});void 0!==state&&null!==state&&($scope.user.person.addresses[0].state=state.id.toString(),promise=$scope.stateSelectChange(state.id),promise.then(function(){var city=_.find($scope.options.cities,function(val_city){return val_city.id==Number(endereco.cidade_info.codigo_ibge.substr(0,6))?val_city:null});return null!==city&&void 0!==city&&($scope.user.person.addresses[0].city=city.id.toString()),$scope.user.person.addresses[0].neighborhood=endereco.bairro,$scope.user.person.addresses[0].address1=endereco.logradouro,!0}).then(function(){$scope.editableInputSeekCep=!0;
}))})}else $scope.editableInputSeekCep=!0}),AuthService.isAuthenticated()?(console.log(AuthService.getUserId()),UsersFactory.show({id:AuthService.getUserId()},function(result){console.log("USUÁRIO",result),$scope.user=result.data,$scope.user.password="",$scope.hasUser=!0})):Notification.error({message:"Você precisa estar logado para ver a sua conta.",title:"Aviso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.updatePassword=function(){AuthService.isAuthenticated()&&UsersFactory.update({id:$scope.user.id,data:$scope.user,onlyPassword:!0},function(result){result.success?(Notification.success({message:"Senha alterada com sucesso.",title:"Aviso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.user.password="",$scope.user.confPassword="",console.log("UPDATE PASSWORD SUCCESS",result)):console.log("UPDATE PASSWORD ERROR",result)})},$scope.updateUser=function(){UsersFactory.update($scope.user,function(result){result.success?(Notification.success({message:"Usuário atualizado com sucesso.",title:"Aviso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.user.password="",$scope.user.confPassword="",console.log("UPDATE USER SUCCESS",result)):console.log("UPDATE USER ERROR",result)})},$scope.updateAddress=function(){AuthService.isAuthenticated()&&UsersFactory.update({id:$scope.user.id,data:$scope.user,onlyAddress:!0},function(result){result.success?(Notification.success({message:"Endereço alterado com sucesso.",title:"Aviso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.user.password="",$scope.user.confPassword="",console.log("UPDATE PASSWORD SUCCESS",result)):console.log("UPDATE PASSWORD ERROR",result)})}}]),R2Site.controller("RecadastrarSenhaCtrl",["$scope","UsersFactory","AuthService","Notification","$state","$stateParams",function($scope,UsersFactory,AuthService,Notification,$state,$stateParams){console.log("RecadastrarSenhaCtrl"),console.log("KEY",$stateParams.key),$scope.user={password:""},$scope.updatePassword=function(){console.log("USER",$scope.user),UsersFactory.save({data:$scope.user,activationKey:$stateParams.key,recadastrarSenha:!0},function(result){result.success?(Notification.success({message:"Senha alterada com sucesso.",title:"Aviso!",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.user.password="",$scope.user.confPassword="",$state.go("root",{},{reload:!0})):console.log("UPDATE PASSWORD ERROR",result)})}}]),R2Site.controller("StoreDetailCtrl",["$scope","store","$stateParams","$sce","Slug",function($scope,store,$stateParams,$sce,Slug){if($scope.renderHtml=function(htmlCode){return $sce.trustAsHtml(htmlCode)},$scope.store={},$scope.videoTeste="",store.success){$scope.store=store.data,$scope.store.slug=Slug.slugify($scope.store.product.title),$scope.store.sellDiscountPrice?$scope.store.price=$scope.store.unitDiscountPrice:$scope.store.price=$scope.store.unitPrice;var cover=_.find($scope.store.product.images,function(image){return image.isCover?!0:void 0});$scope.store.cover=cover,$scope.selectedImage=cover.path,void 0!=$scope.store.product.videos[0]?($scope.videoUrl=$scope.store.product.videos[0].address,$scope.videoTitle="Veja o vídeo deste produto",$scope.showVideo=!0):($scope.videoUrl="",$scope.videoTitle="Em breve um novo video deste produto",$scope.showVideo=!1),console.log("STORE DETAILS",$scope.store)}$scope.setSelectedImage=function(image){$scope.selectedImage=image}}]),R2Site.controller("DepartmentsCtrl",["$scope","$stateParams","StoresFactory","_","Slug",function($scope,$stateParams,StoresFactory,_,Slug){$scope.departmentName=$stateParams.departmentName.toUpperCase(),StoresFactory.show({departmentName:$scope.departmentName,toSell:!0},function(result){console.log("Depts",result),result.success&&($scope.storesCollection=result.data,_.each($scope.storesCollection,function(store){store.slug=Slug.slugify(store.product.title),store.sellDiscountPrice?store.price=store.unitDiscountPrice:store.price=store.unitPrice;var cover=_.find(store.product.images,function(image){return image.isCover?!0:void 0});store.cover=cover})),console.log($scope.storesCollection)})}]),R2Site.controller("LaunchsCtrl",["$scope","StoresFactory","_","Slug",function($scope,StoresFactory,_,Slug){StoresFactory.show({launchs:!0,toSell:!0},function(result){console.log(result),result.success&&($scope.storesCollection=result.data,_.each($scope.storesCollection,function(store){store.slug=Slug.slugify(store.product.title),store.sellDiscountPrice?store.price=store.unitDiscountPrice:store.price=store.unitPrice;var cover=_.find(store.product.images,function(image){return image.isCover?!0:void 0});store.cover=cover})),console.log($scope.storesCollection)})}]),R2Site.controller("CombosCtrl",["$scope","ComboStoresFactory","_","Slug",function($scope,ComboStoresFactory,_,Slug){$scope.loadCombo=!1,ComboStoresFactory.show({toSell:!0},function(result){result.success&&($scope.comboStoresCollection=result.data,_.each($scope.comboStoresCollection,function(store){store.slug=Slug.slugify(store.comboProduct.title),store.sellDiscountPrice?store.price=store.unitDiscountPrice:store.price=store.unitPrice}),console.log("C.OMBOS...",$scope.comboStoresCollection),$scope.loadCombo=!0)})}]),R2Site.controller("ComboStoreDetailCtrl",["$scope","comboStore","$stateParams","$sce","Slug",function($scope,comboStore,$stateParams,$sce,Slug){if($scope.renderHtml=function(htmlCode){return $sce.trustAsHtml(htmlCode)},$scope.comboStore={},$scope.videoTeste="",$scope.selectProduct=function(product){$scope.selectedProduct=product,$scope.selectedImage=product.images[0].path,void 0!=product.videos[0]?($scope.videoUrl=product.videos[0].address,$scope.videoTitle="Veja o vídeo deste produto",$scope.showVideo=!0):($scope.videoUrl="",$scope.videoTitle="Em breve um novo video deste produto",$scope.showVideo=!1)},comboStore.success){console.log("COMBO STORE",comboStore),$scope.comboStore=comboStore.data,$scope.products=$scope.comboStore.comboProduct.products;var firstProduct=$scope.comboStore.comboProduct.products[0];$scope.selectProduct(firstProduct)}$scope.setSelectedImage=function(image){$scope.selectedImage=image}}]),R2Site.controller("SearchProductsCtlr",["$scope","StoresFactory","ComboStoresFactory","_","Slug","$stateParams",function($scope,StoresFactory,ComboStoresFactory,_,Slug,$stateParams){$scope.hasInStore=!1,StoresFactory.show({title:$stateParams.search},function(result){result.success&&($scope.storesCollection=result.data,$scope.storesCollection.length>0&&($scope.hasInStore=!0,_.each($scope.storesCollection,function(store){store.slug=Slug.slugify(store.product.title);var cover=_.find(store.product.images,function(image){return image.isCover?!0:void 0});store.cover=cover})))})}]),R2Site.controller("ComprarProdutoCtrl",["$scope","ngCart","$state",function($scope,ngCart,$state){console.log("COMPRAR PRODUTO CTRL"),$scope.comprarProduto=function(store,isCombo){if(console.log("store",store),ngCart.getItemById(store.id.toString())===!1)if(console.log("IS COMBO",isCombo),void 0!==isCombo){var id=store.id+"-C",name=store.comboProduct.title,price=store.unitDiscountPrice,quantity=1,data={img:store.comboProduct.thumbnail.path,product:store.comboProduct,isCombo:!0};ngCart.addItem(id,name,price,quantity,data)}else{var id=store.id,name=store.product.title,price=store.unitDiscountPrice,quantity=1,data={img:store.cover.path,product:store.product,frete:store.sellNoShipping};ngCart.addItem(id,name,price,quantity,data)}$state.go("root.checkout")}}]),R2Site.controller("CheckoutCtrl",["$scope","AuthService","ngDialog","ngCart","$rootScope","PagSeguroDirectPayment","BoletoBradescoFactory","PagseguroFactory","$sce","_","sessionPagseguroId","StatesFactory","CitiesFactory","$http","$q","CieloFactory","CalcFreteFactory","$window","Notification","CouponsFactory","UsersFactory",function($scope,AuthService,ngDialog,ngCart,$rootScope,PagSeguroDirectPayment,BoletoBradescoFactory,PagseguroFactory,$sce,_,sessionPagseguroId,StatesFactory,CitiesFactory,$http,$q,CieloFactory,CalcFreteFactory,$window,Notification,CouponsFactory,UsersFactory){$scope.transactionModel={card:{notSameCpf:!1,notSameAddress:!1,invoiceaddress:{}}},$scope.transaction=angular.copy($scope.transactionModel),console.log("CheckoutCtrl"),$scope.checkoutChoice=0,$scope.userLogged=!1,$scope.hasBoleto=!1,$scope.editableInputSeekCep=!0,$scope.statesLoad=!1,$scope.stateIsSelected=!1,$scope.citiesLoad=!1,$scope.valorTotal=ngCart.totalCost(),$scope.totalItems=ngCart.getTotalItems(),$scope.installmentsLoad=!1,$scope.pagseguroSession=!1,$scope.servicoFrete="40010",$scope.hasFrete=!1,$scope.hasCoupon=!1,$scope.sessionPagseguroId=sessionPagseguroId.data,PagSeguroDirectPayment.setSessionId($scope.sessionPagseguroId),$scope.coupon={},$scope.calcFrete=function(){var userId=AuthService.getUserId(),items=ngCart.getItems(),servicoFrete=$scope.servicoFrete;_.size(items)>0&&CalcFreteFactory.save({_userId:userId,_items:items,_servico:servicoFrete},function(result){console.log("CALC FRETE",result),result.success&&($scope.hasFrete=!0,ngCart.setShipping(result.data))})},$scope.calcCoupon=function(){console.log($scope.coupon),CouponsFactory.show(function(result){console.log(result);var coupons=result.data;_.each(coupons,function(coupon){if(console.log("COUPON",coupon),coupon.coupon===$scope.coupon.coupon){var totalDiscount=0;if("DEPARTMENT"===coupon.couponType)if(coupon.toAll){var items=ngCart.getItems();_.each(items,function(item){console.log(item);var discount=item._price*(coupon.discount/100);totalDiscount+=discount*item._quantity}),ngCart.setCoupon(coupon.coupon),ngCart.setDiscount(totalDiscount)}else{var items=ngCart.getItems();_.each(items,function(item){console.log(item);var discount=item._price*(coupon.discount/100);totalDiscount+=discount*item._quantity}),ngCart.setCoupon(coupon.coupon),ngCart.setDiscount(totalDiscount)}}})})},$scope.changeShipping=function(){ngCart.setShipping(0),$scope.hasFrete=!1},AuthService.isAuthenticated()&&($scope.userLogged=!0,ngCart.setUser(AuthService.getUserId()),ngCart.setUser(AuthService.getUserId())),$scope.options={states:[],cities:[],installments:[]},StatesFactory.show(function(result){_.each(result.data,function(state){$scope.options.states.push({id:state.id,name:state.code,ibge_code:state.ibge_code})}),$scope.statesLoad=!0}),$scope.stateSelectChange=function(state){var deferred=$q.defer();return state>0&&($scope.options.cities=[],$scope.citiesLoad=!1,$scope.stateIsSelected=!0,CitiesFactory.show({stateId:state},function(result){console.log("CIDADES",result),_.each(result.data,function(city){$scope.options.cities.push({id:city.id,name:city.name})}),$scope.citiesLoad=!0,deferred.resolve()})),deferred.promise},$scope.$watch("transaction.card.invoiceaddress.postcode",function(newVal,oldVal){if(void 0!=newVal){console.log("CEP",newVal),$scope.editableInputSeekCep=!1;var promise=null,callCep="http://api.postmon.com.br/v1/cep/"+newVal;console.log("callCep",callCep),$http.jsonp(callCep+"?callback=JSON_CALLBACK").then(function(response){console.log("CEP",response);var endereco=response.data,state=_.find($scope.options.states,function(val_state){return val_state.name==endereco.estado?val_state:void 0});void 0!==state&&null!==state&&($scope.transaction.card.invoiceaddress.state=state.id.toString(),promise=$scope.stateSelectChange(state.id),promise.then(function(){var city=_.find($scope.options.cities,function(val_city){return val_city.id==Number(endereco.cidade_info.codigo_ibge.substr(0,6))?val_city:null});return null!==city&&void 0!==city&&($scope.transaction.card.invoiceaddress.city=city.id.toString()),$scope.transaction.card.invoiceaddress.neighborhood=endereco.bairro,$scope.transaction.card.invoiceaddress.address1=endereco.logradouro,!0}).then(function(){$scope.editableInputSeekCep=!0}))})}else $scope.editableInputSeekCep=!0}),$scope.$watch("transactionForm.transction_cardNumber.$ccType",function(newVal){void 0!==newVal&&("maestro"==newVal.toLowerCase()&&(newVal="elo"),"american express"==newVal.toLowerCase()&&(newVal="amex"),"diners club"==newVal.toLowerCase()&&(newVal="diners"),PagSeguroDirectPayment.getInstallments({amount:ngCart.totalCost(),brand:newVal.toLowerCase(),maxInstallmentNoInterest:10,success:function(result){$scope.transaction.card.holder=newVal.toLowerCase(),$scope.options.installments=result.installments[newVal.toLowerCase()].slice(0,10),$scope.installmentsLoad=!0},error:function(result){console.log("ERROR getInstallments",result),$scope.installmentsLoad=!1},complete:function(result){console.log("COMPLETE getInstallments",result)}}))}),$scope.$watch("transaction.card.notSameCpf",function(newVal){$scope.transaction.card.otherCpf=""}),$scope.loginShow=function(){ngDialog.openConfirm({template:"/partials/site/pages/user/login/form.html",controller:"LoginCtrl",className:"ngdialog-theme-default",closeByEscape:!0,closeByDocument:!0}).then(function(value){})["catch"](function(value){console.log("CATCH",value)})},$scope.chooseCielo=function(){$scope.checkoutChoice=1},$scope.choosePagseguro=function(){$scope.checkoutChoice=2},$scope.chooseAgain=function(){$scope.checkoutChoice=0},$scope.boletoCliente=function(){UsersFactory.show({id:"816"},function(result){console.log("USER",result),$scope.user=result.data,$scope.boleto={},$scope.boleto.clienteNome=$scope.user.person.name,$scope.boleto.valorTotal=ngCart.totalCost(),$scope.boleto.nossoNumero="1172",$scope.boleto.clienteDocumento="",void 0!==$scope.user.person.documents[1]||($scope.boleto.clienteDocumento="não informado"),$scope.boleto.clienteEndereco1=$scope.user.person.addresses[0].address1+" - N° : "+$scope.user.person.addresses[0].number,void 0!==$scope.user.person.addresses[0].address2&&null!==$scope.user.person.addresses[0].address2&&($scope.boleto.clienteEndereco1+=" / "+$scope.user.person.addresses[0].address2);var cep=$scope.user.person.addresses[0].postcode;cep=cep.replace(/\D/g,""),cep=cep.replace(/(\d{5})(\d)/,"$1-$2"),$scope.boleto.clienteEndereco2=$scope.user.person.addresses[0].city.name+" / "+$scope.user.person.addresses[0].state.code+" - CEP: "+cep;var demonstrativo3="Produtos Adquiridos: ";_.each(ngCart.getItems(),function(item){demonstrativo3+=item._name+" - R$ "+item._price+" - Qtde.: "+item._quantity+"; "}),$scope.boleto.demonstrativo3=demonstrativo3,$scope.boleto.produtosQtde=ngCart.getTotalItems(),setTimeout(function(){$("#form-boleto")[0].submit()},500)})},$scope.checkoutBoleto=function(){console.log("CHECKOUT"),ngDialog.openConfirm({template:"/template/dialogs/boleto-print.html",className:"ngdialog-theme-default",closeByEscape:!0,closeByDocument:!0,scope:$scope}).then(function(value){console.log("value BOLETO BRADESCO",value),BoletoBradescoFactory.save({customer:ngCart.getUser(),items:ngCart.getItems(),coupon:ngCart.getCoupon(),discount:ngCart.getDiscount(),shipping:ngCart.getShipping(),totalAmount:ngCart.totalCost(),servicoFrete:$scope.servicoFrete},function(result){function gerarBoleto(){if($scope.boleto={},$scope.boleto.valorTotal=ngCart.totalCost(),$scope.boleto.nossoNumero=result.pedidoId,$scope.boleto.clienteNome=result.customer.person.name,$scope.boleto.clienteDocumento="",void 0!==result.customer.person.documents[1])$scope.boleto.clienteDocumento=result.customer.person.documents[1].field1;else if(void 0!==result.customer.person.documents[0]){$scope.boleto.clienteDocumento=result.customer.person.documents[0].field1;var v=$scope.boleto.clienteDocumento;v=v.replace(/\D/g,""),v=v.replace(/(\d{3})(\d)/,"$1.$2"),v=v.replace(/(\d{3})(\d)/,"$1.$2"),v=v.replace(/(\d{3})(\d)/,"$1-$2"),$scope.boleto.clienteDocumento=v}else $scope.boleto.clienteDocumento="Não informado";$scope.boleto.clienteEndereco1=result.customer.person.addresses[0].address1+" - N° : "+result.customer.person.addresses[0].number,void 0!==result.customer.person.addresses[0].address2&&null!==result.customer.person.addresses[0].address2&&($scope.boleto.clienteEndereco1+=" / "+result.customer.person.addresses[0].address2);var cep=result.customer.person.addresses[0].postcode;cep=cep.replace(/\D/g,""),cep=cep.replace(/(\d{5})(\d)/,"$1-$2"),$scope.boleto.clienteEndereco2=result.customer.person.addresses[0].city.name+" / "+result.customer.person.addresses[0].state.code+" - CEP: "+cep;var demonstrativo3="Produtos Adquiridos: ";_.each(ngCart.getItems(),function(item){demonstrativo3+=item._name+" - R$ "+item._price+" - Qtde.: "+item._quantity+"; "}),$scope.boleto.demonstrativo3=demonstrativo3,$scope.boleto.produtosQtde=ngCart.getTotalItems(),setTimeout(function(){$("#form-boleto")[0].submit()},500),ngCart.empty(),$scope.totalItems=0,$scope.pedidoId=result.pedidoId,$scope.vendaFinalizada=!0}console.log("CHECKOUT BOLETO BRADESCO",result),result.success&&ngDialog.openConfirm({template:"<p>O Número do Seu Pedido: "+result.pedidoId+'</p><div class="ngdialog-buttons"><button type="button" class="button success" ng-click="closeThisDialog(0)">OK</button></div>',className:"ngdialog-theme-default",plain:!0,closeByEscape:!0,closeByDocument:!0,scope:$scope}).then(function(value){gerarBoleto()})["catch"](function(value){gerarBoleto()})})})["catch"](function(value){})},$scope.checkoutCielo=function(){CieloFactory.save({customer:ngCart.getUser(),transaction:$scope.transaction,items:ngCart.getItems(),coupon:ngCart.getCoupon(),discount:ngCart.getDiscount(),shipping:ngCart.getShipping(),servicoFrete:$scope.servicoFrete},function(result){result.success?(ngCart.empty(),$scope.totalItems=0,$scope.pedidoId=result.pedidoId,$scope.vendaFinalizada=!0,Notification.success({message:"Compra efetuada com sucesso!",title:"Aviso",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.transaction=angular.copy($scope.transactionModel),$scope.transactionForm.$setPristine()):(console.log(result),Notification.error({message:result.code+" | Motivo: "+result.msg,title:"Aviso",templateUrl:"/partials/shared/notifications/generic.html"}),$scope.transaction=angular.copy($scope.transactionModel),$scope.transactionForm.$setPristine())})},$scope.checkoutPagseguro=function(){ngDialog.openConfirm({template:"/template/dialogs/pagseguro-url.html",className:"ngdialog-theme-default",closeByEscape:!0,closeByDocument:!0,scope:$scope}).then(function(value){PagseguroFactory.save({customer:ngCart.getUser(),items:ngCart.getItems(),coupon:ngCart.getCoupon(),discount:ngCart.getDiscount(),shipping:ngCart.getShipping(),totalAmount:ngCart.totalCost(),servicoFrete:$scope.servicoFrete},function(result){console.log("CHECKOUT PAGSEGURO",result),result.success&&(ngCart.empty(),$scope.totalItems=0,$scope.pedidoId=result.pedidoId,$scope.vendaFinalizada=!0,window.open(result.data,"_self"))})})["catch"](function(value){})},$scope.testeA=function(){console.log("getItems",ngCart.getItems());var peso=[],altura=[],largura=[],comprimento=[];_.each(ngCart.getItems(),function(item){console.log("ITEM",item),_.isUndefined(item._data.isCombo)?(peso.push(item._data.product.weight),altura.push(item._data.product.dimensionHeight),largura.push(item._data.product.dimensionLength),comprimento.push(item._data.product.dimensionWidth)):(console.log("É COMBO!!!"),_.each(item._data.products,function(product){peso.push(product.weight),altura.push(product.dimensionHeight),largura.push(product.dimensionLength),comprimento.push(product.dimensionWidth)}))}),console.log("peso",peso),console.log("altura",altura),console.log("largura",largura),console.log("comprimento",comprimento)},$scope.testeB=function(){console.log("getItems",ngCart.getItems()),console.log("getCoupon",ngCart.getCoupon()),console.log("getDiscount",ngCart.getDiscount()),ngCart.empty()},$scope.testeC=function(){console.log("transaction",$scope.transaction),console.log("cart",ngCart.getItems())},$rootScope.$on("ngCart:checkout_succeeded",function(event,args){console.log("BROADCAST",args.data)}),$rootScope.$on("ngCart:change",function(event,args){$scope.valorTotal=ngCart.totalCost(),$scope.totalItems=ngCart.getTotalItems(),0===$scope.totalItems&&(ngCart.setShipping(0),ngCart.setCoupon(null),ngCart.setDiscount(0)),$scope.hasFrete=!1}),$scope.renderHtml=function(htmlCode){return $sce.trustAsHtml(htmlCode)}}]),R2Site.controller("PagseguroCompraFinalizadaCtrl",["$scope","$location","NotificationPagseguroFactory",function($scope,$location,NotificationPagseguroFactory){console.log($location.search().transaction_id),NotificationPagseguroFactory.show({id:$location.search().transaction_id},function(result){console.log("RESULT",result),result.success&&($scope.pedidoId=result.order.id)})}]);